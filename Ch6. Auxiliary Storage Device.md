# Ch6. 보조저장장치

## 6.1 하드 디스크(hard disk)

- **자기 디스크(magnetic hard disk; 디스크)**: 자화될 수 있는 물질로 코팅된 플라스틱 혹은 금속을 이용한 원형 평판으로 만든 저장장치

<img src=".\Images\6-1.PNG" alt="6-1" style="zoom:50%;" />

- 하드 디스크의 주요 구성 요소
  - (1) **원형 평판(circular platter)**: 실제 정보가 저장되는 장소. 트랙(track)들로 구성되어있다.
  - (2) **헤드(head)**: 전도성 코일을 통해 표면을 자화하여 데이터를 저장
  - (3) **디스크 팔(disk arm)**: 헤드를 이동시키는 장치
  - (4) **구동장치(actuator)**: 원형 평판 회전 및 디스크 팔 구동을 위한 모터(motor)



### 6.1.1 디스크의 구조

<img src=".\Images\6-2.PNG" alt="6-2" style="zoom: 40%;" />

- (1) **섹터(sector)**: 트랙의 분할된 각 부분. 데이터 전송 단위인 블록을 저장. 즉, 디스크가 한 번에 액세스할 수 있는 데이터 크기의 최소 단위이다.
- (2) 섹터 간 갭(inter-sector gap): 섹터들을 구분하기 위한 간격
- (3) 트랙 간 갭(inter-track gap): 트랙들을 구분하기 위한 간격. 헤드가 잘못 정렬되거나 자장이 간섭 때문에 발생하는 오류를 방지
- 초기 디스크의 경우, 표면당 트랙의 수 = 500 ~ 2000개, 트랙 당 섹터의 수 = 32개



#### 등각속도(Constant Angular Velocity; CAV) 방식

- 등각속도 방식: 트랙의 길이에 상관없이, 트랙 당 저장되는 데이터 비트 수를 모두 같게 하는 방식. 디스크가 일정한 속도로 회전하는 상태에서, 트랙의 위치에 상관없이 데이터를 동일한 비율로 액세스하게 된다.
- (장점) 읽기, 쓰기 구동장치가 간단하다.
- (단점) 바깥쪽 트랙이 안쪽 트랙보다 더 길지만 저장 밀도가 낮으므로 저장 공간을 낭비한다.



### 6.1.2 디스크 액세스 시간

- **디스크 액세스 동작의 순서**
  - (1) **탐색 시간(seek time)**: 헤드를 해당 트랙으로 이동한다.
  - (2) **회전 지연시간(rotational time)**: 원하는 섹터가 헤드 아래로 회전되어 올 때까지 대기한다.
  - (3) **데이터 전송 시간(data transfer time)**: 데이터를 전송한다.
- **디스크 액세스 시간(disk access time)**: (1) 탐색 시간 + (2) 회전 지연시간 + (3) 데이터 전송 시간 및 디스크 제어기(disk controller)에서 소요되는 시간



#### 디스크 형식화 작업(disk formatting)

<img src=".\Images\6-3.PNG" alt="6-3" style="zoom:40%;" />

- 디스크 형식화 작업: 디스크의 구성을 검사하고, 그에 관한 정보와 트랙의 시작점, 섹터의 시작과 끝을 구분하기 위한 제어 정보 등을 디스크 상의 특정 위치에 저장하는 과정
- 트랙 형식의 예
  - 섹터 크기 = 600바이트 = 데이터 필드(512바이트) + ID 필드 + 갭 3개
  - 제어 정보(ID 필드) : 섹터를 구분하는데 필요한 식별자 또는 주소
    -  (1) SYNCH 바이트: 필드의 시작점을 나타내는 비트 패턴
    - (2) 트랙 번호: n 바이트 고정
    - (3) 헤드 번호
    - (4) 섹터 번호
    - (5) CRC(오류 검출 코드)



#### CRC(Cyclic Redundancy Check)

- CRC: 디스크로부터 데이터를 읽거나, 데이터를 통신하는 과정에서 발생하는 오류를 검출하는 순환 2진 부호를 사용하는 방식
- (송신 측) 블록 단위로 데이터를 나눈 후 각 블록 뒤에 순환 부호를 붙여 저장 후 송신.
  - 2진 다항식의 특수 계산으로 순환 부호 얻음
- (수신 측) 동일한 계산을 수행하여 동일한 순환 부호가 얻어지는지 확인
- 패리티 비트 방식보다 정교하여 오류 검출 능력이 뛰어남
- 저장장치(하드 디스크, CD-ROM, DVD) 및 각종 통신 프로토콜에서 사용



## 6.2 RAID

- 디스크의 신뢰성 문제: 디스크가 고장이 나는 문제
- **RAID(Redundant Array of Independent Disks)**: 다수의 작은 디스크를 배열 구조로 연결한 디스크 시스템
  - (1) 디스크 인터리빙 (2) CRC (3) 디스크 미러링을 통칭
- RAID의 장점
  - 데이터 분산 저장에 의한 동시 액세스(concurrent access) 가능
  - 병렬 데이터 채널에 의한 데이터 전송 속도 향상
  - 신뢰성을 향상
- RAID의 단점: MTTF가 단축됨



#### MTTF(Mean Time To Failure)

- **MTTF**: 디스크가 고장나는데 걸리는 평균 시간

$$
\mathrm{MTTF}=\frac{단일\ 디스크의\ \mathrm{MTTF}}{배열\ 내\ 디스크의\ 수}
$$



### 6.2.1 RAID 출현 배경

- 디스크 배열의 결함 허용도(fault-tolerance)를 높이기 위해 제안됨.
- 결함허용도: 고장에 대해 얼마나 강한가
- RAID의 핵심 기술: 검사 디스크(check disk)를 이용하여 오류를 검출하고 복구하는 기능 (error detection and recovery)을 추가
- 디스크 결함 발생 시 복구 절차(시스템이 정상적인 동작을 유지하고 있는 상태에서 진행)
  - (1) 해당 디스크 사용을 중단하고 시스템으로부터 분리(디스크 용량 축소)
  - (2) 검사 디스크에 저장된 정보로 원래의 데이터 복구
  - (3) 결함을 수리하고 디스크 재설치
  - (4) 시스템 재구성(원래의 디스크 용량을 회복)



#### 디스크 인터리빙(Disk Interleaving)

<img src=".\Images\6-4.PNG" alt="6-4" style="zoom:40%;" />

- **디스크 인터리빙**: 데이터 블록들을 여러 개의 디스크들로 이루어진 디스크 배열(disk array)에 분산 저장하는 기술
- 균등한 분산 저장을 위하여 라운드-로빈(round-robin) 방식을 사용한다.
- 데이터를 병렬로 읽을 수 있다.
  - 라운드 로빈을 사용하지 않는 방식보다 데이터 액세스가 빠르다.



### 6.2.2 RAID의 종류

#### 6.2.2.1 RAID-1

<img src=".\Images\6-5.PNG" alt="6-5" style="zoom:45%;" />

- **디스크 미러링(disk mirroring)** 방식 이용: 디스크에 짝을 이루는 미러 디스크에 동일한 위치로 모든 데이터를 복사
- (장점) 완전한 결함 허용도를 제공: 가정 널리 사용한다
- (단점) 가격이 높다
- (주요 용도)
  - (1) 높은 신뢰도를 요구하는 결함허용시스템에 주로 사용한다.
  - (2) 시스템 소프트웨어 혹은 중요한 데이터 파일 저장에 사용한다.



#### 6.2.2.2 RAID-3

<img src=".\Images\6-6.PNG" alt="6-6" style="zoom:40%;" />

- 패리티(parity) 방식 이용
  - 패리티 비트: $p=b1\oplus b2\oplus b3 \oplus b4$
  - 연산 결과: 1의 개수가 짝수면 p =  0. 홀수면 p =1  
- 결함 발생 시 데이터 복구 방법(예: $b2$ 결함 발생시)
  - $b2=p\oplus b1\oplus b3 \oplus b4$
- (장점)
  - (1) 병렬로 읽기/쓰기가 가능하다: 디스크 액세스 속도 향상
  - (2) 적은 수의 패리티 디스크로 결함허용도를 제공한다.
- (단점) 쓰기 동작 때마다 패리티 비트를 갱신해야 한다: 시간 지연이 발생한다.



#### 6.2.2.3 RAID-2

<img src=".\Images\6-7.PNG" alt="6-7" style="zoom:50%;" />

-  **비트-단위 인터리빙**: 데이터를 비트 단위로 각 디스크에 분산 저장하는 방식
  - **해밍 코드(hamming code)**를 이용하여 오류 검출 및 정정
  - (장점) 디스크 미러링에 가까운 결함허용도 제공
  - (단점)
    - (1) 필요한 검사 디스크들의 수가 많아 가격이 비싸다.
    - (2) 많은 읽기/쓰기 동작이 필요하다.
  - (주요 용도) 오류가 많이 발생하는 환경에서 사용한다.



#### 6.2.2.4 RAID-4

<img src=".\Images\6-8.PNG" alt="6-8" style="zoom:50%;" />

- **블록 단위 인터리빙** 방식을 사용한다.

- 데이터 디스크들의 동일한 위치에 있는 블록들에 대한 패리티 블록을 패리티 디스크에 저장

- (단점) 한 번의 쓰기 동작을 위해 패리티 디스크를 두 번 액세스: 병목 현상 발생

- 데이터 블록 쓰기 과정: 두번째 디스크에 저장된 블록 $B2$를 $B2^`$로 갱신하는 경우

  - 새로운 패리티 블록 $P^`=B1\oplus B2^`\oplus B3\oplus B4$

    - 세 번의 디스크 읽기: $B1, B3, B4$ 읽음
    - 두 번의 디스크 쓰기: 새로운 데이터 쓰기, 패리티 쓰기

  - 디스크 액세스 횟수의 최소화 방법

    <img src=".\Images\6-10.PNG" alt="6-10" style="zoom:50%;" />

    - 네 번의 디스크 액세스: 원래 데이터 읽기, 원래 패리티 읽기, (새로운 패리티 계산), 새로운 데이터 쓰기,  새로운 패리티 쓰기



#### 6.2.2.5 RAID-5

<img src=".\Images\6-9.PNG" alt="6-9" style="zoom:50%;" />

- RAID-4의 문제점을 보완
- 패리티 블록들을 라운드-로빈 방식으로 분산 저장
- (장점)
  - (1) 패리티 디스크에 대한 병목 현상 해소
  - (2) 쓰기 동작을 병렬로 수행할 수 있다: 데이터 디스크의 수 $G$에 대해, 최대 $(G+1)/2$번의 쓰기 동작을 병렬로 수행할 수 있다.
- (단점)
  - (1) 어떤 데이터를 수정하더라도 패리티 디스크도 수정해야한다: 패리티 디스크들에 대해 균등한 액세스가 이루어지지 않는다.
  - (2) **작은 쓰기 문제(small write problem)**: 한 블록을 디스크에 쓰는 경우 네 번의 디스크 액세스가 필요하여 성능이 저하되는 문제
    - 한 비트만 수정해도 패리티 디스크를 수정해야한다(RAID-4에서도 문제)



#### 큰 쓰기(large write)

- 큰 쓰기: 디스크 수보다 더 많은 블록들로 이루어진 파일을 한꺼번에 저장 혹은 갱신하는 것
- 패리티 블록을 미리 계싼하여, 새로운 데이터 및 패리티 블록을 한 번씩만 쓰면 된다.



#### RAID-1과 RAID-5의 비교

- RAID-1: 읽기와 작은 쓰기가 많은 환경에 적합
- RAID-5: 용량과 비용을 중요시하거나 큰 쓰기 요구가 많은 환경에 적합
- 가격 대 성능비 측면: RAID-5 우수



## 6.3 플래시 메모리와 SSD

### SSD의 출현

- 주기억장치는 휘발성 메모리인 DRAM을 이용하므로 주기억장치와 보조저장치 간의 액세스가 빈번하다. 그런데 보조저장장치는 기계장치를 많이 포함한 하드디스크를 이용하여 액세스 속도가 많이 느리다. 즉 주기억장치와 보조저장장치 간의 속도 격차가 크다.
- 이 액세스 속도 간의 격차를 줄이기 위하여, 비휘발성 반도체 기억장치 칩(=플래시 메모리 칩)들을 이용하여 제조된 SSD가 출현한다.



### SSD(Solid-State Drive)

- SSD: 비휘발성 반도체 기억장치들을 이용한 대용량 보조저장장치(다수의 플래시 메모리들을 배열로 구성한 패키지)
- 플래시 메모리 도입
  - 속도 및 신뢰성 향상
  - (장점) 디스크와는 다른 읽기/쓰기 특성을 가지므로 별도의 관리가 필요하다.
  - (단점) 상대적으로 비싸며, 낮은 내구성을 가진다(=데이터 갱신 횟수가 제한적이다.)



### 6.3.1 플래시 메모리

- 플래시 메모밀(Flash EEPROM): EEPROM의 일종



#### 6.3.1.1 동작 원리

<img src=".\Images\6-11.PNG" alt="6-11" style="zoom:50%;" />

- <u>NMOS 트랜지스터로 메모리 셀(기억 소자)을 구현</u>
- N: 전자, MOS: metal, oxide(산화물), semiconductor
- 구조적 특징: 두 개의 게이트를 가진다(일반적인 NMOS는 한 개의 게이트를 가진다)
  - 제어 게이트(control gate): 일반 트랜지스터의 게이트와 동일
  - 부동 게이트(floating gate): 정보를 저장할 때 핵심 역할 수행
- 부동 게이트: 절연체인 산화막($\mathrm{SiO_2}$)으로 둘러쌓여있어 전자들이 쉽게 들어오거나 나기지 못한다. 초기 상태는 비어 있는(empty) 상태로, '1' 저장 상태이다.

<img src=".\Images\6-12.PNG" alt="6-12" style="zoom:50%;" />

- 쓰기 동작(**프로그래밍** 동작): 제어 게이트로 고전압(예: +12V)의 $V_g$를 인가하면, 강력한 전기장의 발생으로 N-채널의 전자들이 산화막을 통과하여 부동 게이트로 진입한다(터널 주입). 이를 **터널링 효과(tunneling effect)**라고 한다. 이는 '0' 쓰기에 해당한다. '1'을 쓰려면 0V의 $V_g$를 인가한다.
- 삭제(erase) 동작: p층(p-well)에 고전압($V_p$)을 인가하면, 부동 게이트의 전자들이 산화막을 통과하여 N 채널로 빠져나온다(터널 릴리즈). 셀에 저장된 값을 원래 값('1')로 변경한다.
- 읽기 동작
  - 드레인 전압($V_d$: 5V) 인가: N-채널을 통하여 전자의 흐름이 발생
  - 게이트 전압($V_g$: 5V) 인가: 전기장 발생
  - 저장된 데이터가 '1'인 경우(부동 게이트가 빈 상태)
    - N-채널이 확장된다.
    - 많은 전류가 흘러 트랜지스터의 상태가 'ON'이 된다: '1'을 읽음.
  - 저장된 데이터가 '0'인 경우(부동 게이트가 채워진 상태)
    - N-채널이 유지된다.
    - 작은 전류가 흘러 트랜지스터의 상태가 'OFF'이 된다: '0'을 읽음.



#### 6.3.1.3 SLC, MLC 및 TLC

<img src=".\Images\6-13.PNG" alt="6-13" style="zoom:50%;" />

- 부동 게이트로 들어가는 전자들의 수를 조정하여 각 셀에 저장되는 상태의 수를 증가시킨다.
  - SLC(single-levle cell): 두 가지 상태를 가진다. 즉 셀 당 한 비트를 저장한다.
  - MLC(multi-level cell): 네 가지 상태를 가진다. 즉 셀 당 두 비트를 저장한다.
  - TLC(triple-level cell): 여덟 가지 상태를 가진다. 즉 셀 당 세 비트를 저장한다.
- MLC 및 TLC의 문제점: 다른 종류에 비해 읽기/쓰기 느림.
  - (1) 전자의 수를 조정하기 위하여 세밀한 작업이 필요하다.
  - (2) 데이터 구분이 어려워 액세스 속도가 느리다.
  - (3) 오류 발생 빈도가 증가한다.
  - (4) 수명이 단축된다.



### 6.3.2 SSD(Solid-State Drive)

- 플래시 메모리 칩
  - PCB(Printed Circuit Board) 앞면과 뒷면에 각각 4개의 64층 QLC 플래시 장착
  - 동시 액세스 및 병렬 데이터 전송을 지원: 인터리빙 방식으로 데이터를 분산 저장, 병렬 입출력 채널 구성
- SSD 제어기(controller)
  - 데이터 저장과 인출, 칩 관리, 주소 변환 등과 같은 핵심적 기능을 수행
  - 펌웨어 수준의 프로그램을 수행하는 프로세서로 구현
- DRAM 캐시: 컴퓨터와 플래시 메모리 사이의 데이터 버퍼
- 외부 인터페이스: SATA, PCle 등을 이용한 직렬 전송
- FTL(Flash Translation Layer): 기존의 파일 시스템과 OS로 하여금 SSD(의 플래시 메모리)를 HDD(의 섹터)와 같은 방법으로 사용할 수 있도록 지원해주는 미들웨어
  - (1) 플래시 메모리의 페이지 주소와 HDD의 섹터 주소 간의 매핑(mapping) 기능
  - FTL이 SSD의 성능 향상을 위하여 수행하는 기능
    - (2) 마모 평준화(wear leveling): 각 페이지의 사용 횟수를 기록하고, 이것을 쓰기 동작 때 참고하여 모든 페이지들이 고르게 사용되도록 사용 횟수가 가장 적은 페이지를 저장 위치로 조정한다.
      - (필요성) 플래시 메모리들의 재기록 바복횟수(셀 수명)에는 제한이 있어, RW 동작들이 일부 블록이나 페이지에 집중될 경우 전체 SSD 수명이 단축됨. 이를 해결하기 위하여 
    - (3) 쓰레기 수집(garbage collection): 페이지 수정 내용을 다른 곳에 저장하고, 수정 전의 페이지를 쓰레기로 표시하여 쓰레기가 많이 축적된 블록을 한꺼번에 삭제
      - (필요성) RW 동작이 블록 단위로 이루어져 수정이 필요했던 원래 페이지를 삭제해야 함.
    - (4) 초과 대비공간(over-provisioning; 오버-프로비저닝): SSD 내부에 여분의 저장 공간을 제공한다.
      - (필요성) 마모 평준화의 효율을 높이기 위해 (수정 페이지와 쓰레기 페이지의 일시적 중복 저장을 위하여) 추가 저장 공간이 필요하다.



